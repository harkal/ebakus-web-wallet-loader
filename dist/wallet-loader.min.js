/*!
 * The Ebakus wallet loader library creates an iframe and loads the web wallet library in there. It can accept custom configurations for the wallet (i.e. load custom tokens) and act as an interface between the dApp and the web wallet iframe. This way a user can use his wallet to interface with any ebakus dApp she wants without having to create new keys and manage multiple accounts. v0.1.4
 * 
 * @author Ebakus AG <hello@ebakus.com>
 * @website https://www.ebakus.com/
 * 
 * @copyright Ebakus 2020
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["ebakus-web-wallet-loader"]=e():t.ebakusWallet=e()}(this,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=38)}([function(t,e){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},function(t,e,n){t.exports=!n(3)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},function(t,e,n){var r=n(4);t.exports=function(t){if(!r(t))throw TypeError(t+" is not an object!");return t}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},function(t,e){var n=t.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)},function(t,e,n){"use strict";var r=n(2);t.exports=function(){var t=r(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e,n){var r=n(15),o=n(31);t.exports=n(1)?function(t,e,n){return r.f(t,e,o(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var r=n(0),o=n(9),i=n(32),c=n(13)("src"),a=n(33),u=(""+a).split("toString");n(7).inspectSource=function(t){return a.call(t)},(t.exports=function(t,e,n,a){var l="function"==typeof n;l&&(i(n,"name")||o(n,"name",e)),t[e]!==n&&(l&&(i(n,c)||o(n,c,t[e]?""+t[e]:u.join(String(e)))),t===r?t[e]=n:a?t[e]?t[e]=n:o(t,e,n):(delete t[e],o(t,e,n)))})(Function.prototype,"toString",(function(){return"function"==typeof this&&this[c]||a.call(this)}))},function(t,e,n){var r=n(12)("wks"),o=n(13),i=n(0).Symbol,c="function"==typeof i;(t.exports=function(t){return r[t]||(r[t]=c&&i[t]||(c?i:o)("Symbol."+t))}).store=r},function(t,e,n){var r=n(7),o=n(0),i=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:r.version,mode:n(24)?"pure":"global",copyright:"Â© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++n+r).toString(36))}},function(t,e,n){"use strict";var r,o,i=n(8),c=RegExp.prototype.exec,a=String.prototype.replace,u=c,l=(r=/a/,o=/b*/g,c.call(r,"a"),c.call(o,"a"),0!==r.lastIndex||0!==o.lastIndex),s=void 0!==/()??/.exec("")[1];(l||s)&&(u=function(t){var e,n,r,o,u=this;return s&&(n=new RegExp("^"+u.source+"$(?!\\s)",i.call(u))),l&&(e=u.lastIndex),r=c.call(u,t),l&&r&&(u.lastIndex=u.global?r.index+r[0].length:e),s&&r&&r.length>1&&a.call(r[0],n,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(r[o]=void 0)})),r}),t.exports=u},function(t,e,n){var r=n(2),o=n(28),i=n(30),c=Object.defineProperty;e.f=n(1)?Object.defineProperty:function(t,e,n){if(r(t),e=i(e,!0),r(n),o)try{return c(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){"use strict";var r=n(2),o=n(17),i=n(18),c=n(6),a=n(19),u=n(21),l=Math.max,s=Math.min,f=Math.floor,d=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;n(25)("replace",2,(function(t,e,n,v){return[function(r,o){var i=t(this),c=null==r?void 0:r[e];return void 0!==c?c.call(r,i,o):n.call(String(i),r,o)},function(t,e){var o=v(n,t,this,e);if(o.done)return o.value;var f=r(t),d=String(this),p="function"==typeof e;p||(e=String(e));var h=f.global;if(h){var m=f.unicode;f.lastIndex=0}for(var y=[];;){var w=u(f,d);if(null===w)break;if(y.push(w),!h)break;""===String(w[0])&&(f.lastIndex=a(d,i(f.lastIndex),m))}for(var x,b="",E=0,S=0;S<y.length;S++){w=y[S];for(var k=String(w[0]),_=l(s(c(w.index),d.length),0),O=[],j=1;j<w.length;j++)O.push(void 0===(x=w[j])?x:String(x));var M=w.groups;if(p){var I=[k].concat(O,_,d);void 0!==M&&I.push(M);var N=String(e.apply(void 0,I))}else N=g(k,d,_,O,M,e);_>=E&&(b+=d.slice(E,_)+N,E=_+k.length)}return b+d.slice(E)}];function g(t,e,r,i,c,a){var u=r+t.length,l=i.length,s=p;return void 0!==c&&(c=o(c),s=d),n.call(a,s,(function(n,o){var a;switch(o.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(u);case"<":a=c[o.slice(1,-1)];break;default:var s=+o;if(0===s)return n;if(s>l){var d=f(s/10);return 0===d?n:d<=l?void 0===i[d-1]?o.charAt(1):i[d-1]+o.charAt(1):n}a=i[s-1]}return void 0===a?"":a}))}}))},function(t,e,n){var r=n(5);t.exports=function(t){return Object(r(t))}},function(t,e,n){var r=n(6),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,e,n){"use strict";var r=n(20)(!0);t.exports=function(t,e,n){return e+(n?r(t,e).length:1)}},function(t,e,n){var r=n(6),o=n(5);t.exports=function(t){return function(e,n){var i,c,a=String(o(e)),u=r(n),l=a.length;return u<0||u>=l?t?"":void 0:(i=a.charCodeAt(u))<55296||i>56319||u+1===l||(c=a.charCodeAt(u+1))<56320||c>57343?t?a.charAt(u):i:t?a.slice(u,u+2):c-56320+(i-55296<<10)+65536}}},function(t,e,n){"use strict";var r=n(22),o=RegExp.prototype.exec;t.exports=function(t,e){var n=t.exec;if("function"==typeof n){var i=n.call(t,e);if("object"!=typeof i)throw new TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==r(t))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(t,e)}},function(t,e,n){var r=n(23),o=n(11)("toStringTag"),i="Arguments"==r(function(){return arguments}());t.exports=function(t){var e,n,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),o))?n:i?r(e):"Object"==(c=r(e))&&"function"==typeof e.callee?"Arguments":c}},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e){t.exports=!1},function(t,e,n){"use strict";n(26);var r=n(10),o=n(9),i=n(3),c=n(5),a=n(11),u=n(14),l=a("species"),s=!i((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),f=function(){var t=/(?:)/,e=t.exec;t.exec=function(){return e.apply(this,arguments)};var n="ab".split(t);return 2===n.length&&"a"===n[0]&&"b"===n[1]}();t.exports=function(t,e,n){var d=a(t),p=!i((function(){var e={};return e[d]=function(){return 7},7!=""[t](e)})),v=p?!i((function(){var e=!1,n=/a/;return n.exec=function(){return e=!0,null},"split"===t&&(n.constructor={},n.constructor[l]=function(){return n}),n[d](""),!e})):void 0;if(!p||!v||"replace"===t&&!s||"split"===t&&!f){var g=/./[d],h=n(c,d,""[t],(function(t,e,n,r,o){return e.exec===u?p&&!o?{done:!0,value:g.call(e,n,r)}:{done:!0,value:t.call(n,e,r)}:{done:!1}})),m=h[0],y=h[1];r(String.prototype,t,m),o(RegExp.prototype,d,2==e?function(t,e){return y.call(t,this,e)}:function(t){return y.call(t,this)})}}},function(t,e,n){"use strict";var r=n(14);n(27)({target:"RegExp",proto:!0,forced:r!==/./.exec},{exec:r})},function(t,e,n){var r=n(0),o=n(7),i=n(9),c=n(10),a=n(34),u=function(t,e,n){var l,s,f,d,p=t&u.F,v=t&u.G,g=t&u.S,h=t&u.P,m=t&u.B,y=v?r:g?r[e]||(r[e]={}):(r[e]||{}).prototype,w=v?o:o[e]||(o[e]={}),x=w.prototype||(w.prototype={});for(l in v&&(n=e),n)f=((s=!p&&y&&void 0!==y[l])?y:n)[l],d=m&&s?a(f,r):h&&"function"==typeof f?a(Function.call,f):f,y&&c(y,l,f,t&u.U),w[l]!=f&&i(w,l,d),h&&x[l]!=f&&(x[l]=f)};r.core=o,u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,t.exports=u},function(t,e,n){t.exports=!n(1)&&!n(3)((function(){return 7!=Object.defineProperty(n(29)("div"),"a",{get:function(){return 7}}).a}))},function(t,e,n){var r=n(4),o=n(0).document,i=r(o)&&r(o.createElement);t.exports=function(t){return i?o.createElement(t):{}}},function(t,e,n){var r=n(4);t.exports=function(t,e){if(!r(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!r(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){t.exports=n(12)("native-function-to-string",Function.toString)},function(t,e,n){var r=n(35);t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,n){"use strict";n(37);var r=n(2),o=n(8),i=n(1),c=/./.toString,a=function(t){n(10)(RegExp.prototype,"toString",t,!0)};n(3)((function(){return"/a/b"!=c.call({source:"a",flags:"b"})}))?a((function(){var t=r(this);return"/".concat(t.source,"/","flags"in t?t.flags:!i&&t instanceof RegExp?o.call(t):void 0)})):"toString"!=c.name&&a((function(){return c.call(this)}))},function(t,e,n){n(1)&&"g"!=/./g.flags&&n(15).f(RegExp.prototype,"flags",{configurable:!0,get:n(8)})},function(t,e,n){"use strict";n.r(e),n(16),n(36);let r,o,i,c=!1,a=!0;const u={},l="ebakus-wallet-frame",s="\n#ebakus-wallet-frame {\n  position: fixed;\n  top: 0;\n  right: 0;\n  min-width: ".concat(150,"px;\n  height: ").concat(60,"px;\n  z-index: 2147483647;\n}\n\n#ebakus-wallet-frame.active {\n  right: 0 !important;\n  width: 340px;\n  height: 100% !important;\n}\n\n#ebakus-wallet-frame.active.overlay {\n  left: 0 !important;\n  right: auto !important;\n  width: 100% !important;\n}\n"),f=()=>{const t=()=>Math.random().toString(36).slice(2);let e=t();for(;e in u;)e=t();return e},d=t=>{const e=document.createElement("a");return e.setAttribute("href",t),e.origin},p=t=>{const e=document.createElement("iframe");e.id=l,e.setAttribute("frameBorder","0"),e.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups"),e.onload=()=>{g("_"),c=!0,window.dispatchEvent(new CustomEvent("ebakusLoaded"))},r=d(t),e.src=r;try{document.body.appendChild(e),i=e.contentWindow}catch(t){const n=()=>{(document.body||document.documentElement).appendChild(e),i=e.contentWindow,window.removeEventListener("DOMContentLoaded",n)};window.addEventListener("DOMContentLoaded",n)}o=e},v=(t,e)=>{const n={id:f(),cmd:t,req:e};return new Promise((e,o)=>{u[n.id]=n=>{delete u[n.id],n.cmd!==t&&o(new Error("Wallet response is not for this request"));const{res:r,err:i}=n;null==r?o(i||new Error("Please try again")):e(r)};try{i.postMessage(JSON.stringify(n),r)}catch(t){delete u[n.id]}})},g=(t,e)=>{const n={cmd:t,passive:!0,req:e};try{i.postMessage(JSON.stringify(n),r)}catch(t){}},h=t=>{if(t.origin===window.location.origin)return;if(t.origin!==r||t.source!==i)return;const e=JSON.parse(t.data),{id:n,cmd:c,req:l}=e;if(n&&u[n])u[n](e);else if(a)if("active"===c&&-1===o.className.indexOf("active"))o.className+=" active",o.removeAttribute("style");else if("inactive"===c)o.className=o.className.replace(/\bactive\b/g,"");else if("resize"===c){let t="";const n=parseInt(e.width,10),r=parseInt(e.height,10);r>60&&(t+="height: ".concat(r,"px;")),n>150&&(t+="width: ".concat(n,"px;")),""!=t?o.setAttribute("style",t):o.removeAttribute("style")}else if("withOverlay"===c&&-1===o.className.indexOf("overlay"))o.className+=" overlay";else if("withoutOverlay"===c)o.className=o.className.replace(/\boverlay\b/g,"");else if("openInNewTab"===c&&"string"==typeof l){const t=Object.assign(document.createElement("a"),{target:"_blank",href:l});if(t.origin===window.location.origin)return void(window.location.href=l);const e=new MouseEvent("click",{view:window});t.dispatchEvent(e)}else if("localStorageSet"===c){const{key:t,data:e}=l;t&&e&&localStorage.setItem("".concat("_com.ebakus.wallet",":").concat(t),"string"==typeof e?e:JSON.stringify(e))}else if("localStorageGet"===c){const{key:t}=l;if(t){const e=localStorage.getItem("".concat("_com.ebakus.wallet",":").concat(t));try{i.postMessage(JSON.stringify({id:n,cmd:c,req:l,res:e}),r)}catch(t){}}}else if("localStorageRemove"===c){const{key:t}=l;t&&localStorage.removeItem("".concat("_com.ebakus.wallet",":").concat(t))}else if("event"===c){const{type:t,data:n}=e;"string"==typeof t&&window.dispatchEvent(new CustomEvent(t,{detail:n}))}},m=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://wallet.ebakus.com";const e=document.getElementById(l);if(e){if(r=d(e.src),r!==d(t))throw new Error("You are not allowed to connect on different wallets in same window");return o=e,i=o.contentWindow,c=!0,a=!1,void window.addEventListener("message",h,!1)}},y=()=>{window.removeEventListener("message",h,!1);const t=document.getElementById(l);t&&t.remove(),window._ebkWalletMainInstanceLock=!1,c=!1,a=!0,r=null,o=null,i=null};const w=()=>v("getAccount");e.default={init:t=>{const{walletEndpoint:e,tokens:n}=t||{};if(n){const t=()=>{g("init",{tokens:n}),window.removeEventListener("ebakusLoaded",t)};window.addEventListener("ebakusLoaded",t)}!function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"https://wallet.ebakus.com";if(!0===window._ebkWalletMainInstanceLock){let e=0;const n=setInterval((function(){document.getElementById(l)&&(m(t),clearInterval(n)),e>20&&(clearInterval(n),y()),e++}),300);return}window._ebkWalletMainInstanceLock=!0;const e=document.createElement("style");e.className="ebakus-styles",e.innerHTML=s,document.getElementsByTagName("head")[0].appendChild(e),p(t),window.addEventListener("message",h,!1)}(e)},unloadWallet:y,isWalletFrameLoaded:()=>(()=>c)(),unlockWallet:t=>g("unlockWallet",t),getCurrentProviderEndpoint:()=>v("currentProviderEndpoint"),getAccount:w,getDefaultAddress:()=>w(),getBalance:()=>v("getBalance"),getStaked:()=>v("getStaked"),sendTransaction:t=>v("sendTransaction",t)}}]).default}));